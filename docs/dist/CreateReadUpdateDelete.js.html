<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>CreateReadUpdateDelete.js</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" type="text/css">
    <link rel="stylesheet" href="../css/bootstrap.css">
    <link rel="stylesheet" href="../css/cayman.css">
    <link rel="stylesheet" href="../css/prism.css">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">CreateReadUpdateDelete.js</h1>
      <h2 class="project-tagline"></h2>
    </section>
    <section data-spy="scroll" data-target=".scrollspy" class="main-content">
      <div class="row">
        <div class="col-md-3 col-xs-3 bs-docs-sidebar">
          <ul id="sidebar" class="nav nav-stacked fixed">
            <li><a href="../index.html">Main</a></li>
            <li><a href="../CRUD.SqliteAdapter.js.html">CRUD.SqliteAdapter.js</a></li>
            <li><a href="../CRUD.entities.js.html">CRUD.entities.js</a></li>
            <li><a href="../CRUD.js.html">CRUD.js</a></li>
            <li><a href="../demo/Episode.js.html">demo/Episode.js</a></li>
            <li><a href="../demo/Season.js.html">demo/Season.js</a></li>
            <li><a href="../demo/Serie.js.html">demo/Serie.js</a></li>
            <li><a href="../demo/prism.js.html">demo/prism.js</a></li>
            <li class="active"><a href="../dist/CreateReadUpdateDelete.js.html">dist/CreateReadUpdateDelete.js
                <ul class="nav nav-stacked">
                  <li><a href="#if"><i class="alert alert-info"></i><span>if</span></a>
                  </li>
                </ul></a></li>
            <li><a href="../docs/docs/js.html">docs/docs/js</a></li>
            <li><a href="../docs/js.html">docs/js</a></li>
            <li><a href="../docs/js/affix.js.html">docs/js/affix.js</a></li>
            <li><a href="../docs/js/bootstrap.min.js.html">docs/js/bootstrap.min.js</a></li>
            <li><a href="../docs/js/dropdown.js.html">docs/js/dropdown.js</a></li>
            <li><a href="../docs/js/jquery.min.js.html">docs/js/jquery.min.js</a></li>
            <li><a href="../docs/js/prism-bash.js.html">docs/js/prism-bash.js</a></li>
            <li><a href="../docs/js/prism-jade.js.html">docs/js/prism-jade.js</a></li>
            <li><a href="../docs/js/prism.js.html">docs/js/prism.js</a></li>
            <li><a href="../docs/js/scrollspy.js.html">docs/js/scrollspy.js</a></li>
            <li><a href="../tests/tests.js.html">tests/tests.js</a></li>
          </ul>
        </div>
        <div class="col-md-9">
          <section id="if">
            <h1>if</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>if()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"></div>
          <pre><code class="language-javascript">if(!CRUD)var CRUD={RELATION_SINGLE:1,RELATION_FOREIGN:2,RELATION_MANY:3,RELATION_CUSTOM:4,DEBUG:!1,stats:{writesQueued:0,writesExecuted:0},log:function(){CRUD.DEBUG&amp;&amp;console.log.apply(console,arguments)}};CRUD.EntityManager=function(){this.entities={},this.constructors={},this.cache={},this.connectionAdapter=!1,this.defaultSetup={className:&quot;CRUD.Entity&quot;,ID:!1,table:!1,primary:!1,fields:[],indexes:[],autoSerialize:[],defaultValues:{},adapter:!1,orderProperty:!1,orderDirection:!1,relations:{},connectors:{},createStatement:!1,keys:[]};var t=function(t){return t.charAt(0).toUpperCase()+t.slice(1)};return this.registerEntity=function(e,n,i){e.prototype=Object.create(CRUD.Entity.prototype),e.prototype.constructor=CRUD.Entity,n.fields.map(function(t){Object.defineProperty(e.prototype,t,{get:t in i&amp;&amp;&quot;get&quot;in i[t]?i[t].get:function(){return this.get(t)},set:t in i&amp;&amp;&quot;set&quot;in i[t]?i[t].set:function(e){this.set(t,e)},enumerable:!1,configurable:!0})},e);for(var r in i)-1==n.fields.indexOf(r)&amp;&amp;(e.prototype[r]=i[r]);var s=n.className;Object.defineProperty(e.prototype,&quot;__className__&quot;,{get:function(){return s},enumerable:!1,configurable:!0}),CRUD.log(&quot;Register entity&quot;,e,n,s),s in this.entities||(this.entities[s]=Object.clone(this.defaultSetup));for(var a in n)this.entities[s][a]=n[a];return this.constructors[s]=function(t){var n=new e;return t&amp;&amp;n.primaryKeyInit(t),n},e.findByID=function(t){var e={};return e[n.primary]=t,CRUD.FindOne(s,e)},e.Find=function(t,e){return CRUD.Find(s,t,e)},e.FindOne=function(t,e){return CRUD.FindOne(s,t,e)},n.fields.map(function(n){e[&quot;findOneBy&quot;+t(n)]=function(t,e){var i={};return i[n]=t,CRUD.FindOne(s,i,e||{})},e[&quot;findBy&quot;+t(n)]=function(t,e){var i={};return i[n]=t,CRUD.Find(s,i,e||{})a}}),Object.keys(n.relations).map(function(t){CRUD.log(&quot;creating relation search for &quot;,t,&quot; to &quot;,s),e[&quot;findBy&quot;+t]=function(e){var n={};return n[t]=e,CRUD.Find(s,n)},e[&quot;findOneBy&quot;+t]=function(e){var n={};return n[t]=e,CRUD.FindOne(s,n)}}),e},this.getPrimary=function(t){if(!t||!this.entities[t])throw&quot;Invalid className passed to CRUD.EntityManager.getPrimary : &quot;+t;return this.entities[t].primary},this.getDefaultValues=function(t){if(!t||!this.entities[t])throw&quot;Invalid className passed to CRUD.EntityManager.getDefaultValues : &quot;+t;return this.entities[t].defaultValues},this.setAdapter=function(t){return this.connectionAdapter=t,this.connectionAdapter.Init()},this.getAdapter=function(){return this.connectionAdapter},this.getFields=function(t){return this.entities[t].fields},this.hasRelation=function(t,e){return e in this.entities[t].relations},this}(),CRUD.define=function(t,e,n){return CRUD.EntityManager.registerEntity(t,e,n)},CRUD.setAdapter=function(t){return CRUD.EntityManager.setAdapter(t)},CRUD.Find=function(t,e,n){var i=null;if(t instanceof CRUD.Entity||t.prototype instanceof CRUD.Entity)i=t.getType(),t.getID()!==!1&amp;&amp;(CRUD.log(&quot;Object has an ID! &quot;,ID,i),e.ID=t.getID(),e.type=e);else{if(!(t in CRUD.EntityManager.entities))throw&quot;CRUD.Find cannot search for non-CRUD objects like &quot;+t+&quot;!&quot;;i=t}return CRUD.EntityManager.getAdapter().Find(i,e,n).then(function(t){return t.map(function(t){i in CRUD.EntityManager.cache||(CRUD.EntityManager.cache[i]={});var e=CRUD.EntityManager.entities[i].primary;return t[e]in CRUD.EntityManager.cache[i]||(CRUD.EntityManager.cache[i][t[e]]=new CRUD.EntityManager.constructors[i]),CRUD.EntityManager.cache[i][t[e]].importValues(t)})})},CRUD.FindOne=function(t,e,n){return n=n||{},n.limit=1,this.Find(t,e,n).then(function(t){return t[0]})},CRUD.fromCache=function(t,e){try{t=&quot;function&quot;==typeof t?new t:new CRUD.EntityManager.constructors[t],type=t instanceof CRUD.Entity?t.getType():!1}catch(n){return CRUD.log(&quot;CRUD.fromCache cannot create for non-CRUD objects like &quot;+t+&quot;! \n&quot;+n),!1}return t.importValues(e,!0),t},CRUD.ConnectionAdapter=function(t,e){return this.endpoint=t||!1,this.options=e||{},this.Init=function(){CRUD.log(&quot;The Init method for you connection adapter is not implemented!&quot;)},this.Delete=function(){CRUD.log(&quot;The Delete method for your connection adaptor is not implemented!&quot;)},this.Persist=function(){CRUD.log(&quot;The Persist method for your connection adaptor is not implemented!&quot;)},this.Find=function(){CRUD.log(&quot;The Find method for your connection adaptor is not!&quot;)},this},CRUD.Entity=function(){return this.__values__={},this.__dirtyValues__={},this},CRUD.Entity.prototype={getID:function(){return this.get(CRUD.EntityManager.getPrimary(this.getType()))||!1},asObject:function(){return this.__values__},Find:function(t,e,n){return n=n||{},e=e||{},e[this.getType()]={},e[this.getType()][CRUD.EntityManager.getPrimary(this.getType())]=this.getID(),CRUD.Find(t,e,n)},getValues:function(){var t=this.__values__;if(this.____dirtyValues____&amp;&amp;Array.from(this.____dirtyValues____).length&gt;0)for(var e in this.__dirtyValues__)t[e]=this.__dirtyValues__[e];return t.ID=this.getID(),t},importValues:function(t,e){for(var n in t)this.__values__[n]=CRUD.EntityManager.entities[this.getType()].autoSerialize.indexOf(n)&gt;-1?JSON.parse(t[n]):t[n];return e&amp;&amp;(this.__dirtyValues__=this.__values__,this.__values__={}),this},get:function(t){var e;return t in this.__dirtyValues__?e=this.__dirtyValues__[t]:t in this.__values__?e=this.__values__[t]:CRUD.log(&quot;Could not find field '&quot;+t+&quot;' in '&quot;+this.getType()+&quot;' (for get)&quot;),e},set:function(t,e){t in this?this.get(t)===e||[null,void 0].indexOf(this.get(t))&gt;-1&amp;&amp;[null,void 0].indexOf(e)&gt;-1||(CRUD.EntityManager.entities[this.getType()].autoSerialize.indexOf(t)&gt;-1?JSON.stringify(this.get(t))!=JSON.stringify(e)&amp;&amp;(this.__dirtyValues__[t]=e):this.__dirtyValues__[t]=e):CRUD.log(&quot;Could not find field '&quot;+t+&quot;' in '&quot;+this.getType()+&quot;' (for set)&quot;)},Persist:function(t){var e=this,n=this.getType();return new Promise(function(i,r){if(!t&amp;&amp;0==Object.keys(e.__dirtyValues__).length)return i();if(e.get(CRUD.EntityManager.getPrimary(e.getType()))===!1||t){var s=CRUD.EntityManager.entities[e.getType()].defaultValues;if(Object.keys(s).length&gt;0)for(var a in s)a in e&amp;&amp;!e.__dirtyValues__[a]&amp;&amp;(e.__dirtyValues__[a]=s[a])}return CRUD.EntityManager.getAdapter().Persist(e,t).then(function(t){CRUD.log(e.getType()+&quot; has been persisted. Result: &quot;+t.Action+&quot;. New Values: &quot;+JSON.stringify(e.__dirtyValues__)),&quot;inserted&quot;==t.Action&amp;&amp;(e.__dirtyValues__[CRUD.EntityManager.getPrimary(n)]=t.ID,n in CRUD.EntityManager.cache||(CRUD.EntityManager.cache[n]={}),CRUD.EntityManager.cache[n][t.ID]=e);for(var r in e.__dirtyValues__)e.__values__[r]=e.__dirtyValues__[r];e.__dirtyValues__={},e.ID=e.__values__[CRUD.EntityManager.getPrimary(n)],i(t)},function(t){CRUD.log(&quot;Error saving CRUD&quot;,e,t),r(t)})})},Delete:function(){var t=this;return CRUD.EntityManager.getAdapter().Delete(t).then(function(e){return&quot;deleted&quot;==e.Action&amp;&amp;(CRUD.log(t.getType()+&quot; &quot;+t.getID()+&quot; has been deleted! &quot;),delete CRUD.EntityManager.cache[t.getType()][t.getID()],t.__values__[CRUD.EntityManager.getPrimary(t.getType())].ID=!1),e})},getType:function(){return this.__className__},Connect:function(t){var e=t.getType(),n=(this.getType(),this.dbSetup.primary),i=t.dbSetup.primary,r=this;new Promise(function(s,a){Promise.all([r.Persist(),t.Persist()]).then(function(){switch(r.dbSetup.relations[e]){case CRUD.RELATION_SINGLE:t.set(n,r.getID()),r.set(i,t.getID());break;case CRUD.RELATION_FOREIGN:n in t&amp;&amp;t.set(n,r.getID()),i in r&amp;&amp;r.set(i,t.getID());break;case CRUD.RELATION_MANY:var o=new window[r.dbSetup.connectors[e]];return o.set(n,r.getID()),o.set(i,t.getID()),void o.Persist().then(s,a);case CRUD.RELATION_CUSTOM:}r.dbSetup.relations[t.getType()]!=CRUD.RELATION_MANY&amp;&amp;Promise.all([t.Persist(),from.Persist()]).then(s,a)},a)})},Disconnect:function(t){var e=t.getType(),n=(this.getType(),CRUD.EntityManager.getPrimary(this)),i=CRUD.Entitymanager.getPrimary(t),r=this;new Promise(function(s,a){Promise.all([r.Persist(),t.Persist()]).then(function(){switch(this.dbSetup.relations[t.getType()]){case CRUD.RELATION_SINGLE:t.set(n,null),r.set(i,null);break;case CRUD.RELATION_FOREIGN:n in t&amp;&amp;t.set(n,null),i in r&amp;&amp;r.set(i,null);break;case CRUD.RELATION_MANY:var o={};return o[n]=this.getID(),o[i]=t.getID(),void CRUD.FindOne(this.dbSetup.connectors[e],o).then(function(t){t.Delete().then(s,a)},a);case CRUD.RELATION_CUSTOM:}Promise.all([r.Persist(),this.Persist()]).then(s,a)},a)})},primaryKeyInit:function(t){return this.ID=t||!1,this.ID!==!1?this.Find({ID:t}):void 0}},&quot;clone&quot;in Object||(Object.clone=function(t){return JSON.parse(JSON.stringify(t))}),CRUD.executeQuery=function(t,e){return CRUD.EntityManager.getAdapter().db.execute(t,e||[])},CRUD.SQLiteAdapter=function(t,e){function n(t){return CRUD.stats.writesExecuted++,t.Action=&quot;updated&quot;,t}function i(t){console.error(&quot;Update query error!&quot;,t),CRUD.stats.writesExecuted++}function r(t){return t.Action=&quot;inserted&quot;,t.ID=t.rs.insertId,CRUD.stats.writesExecuted++,t}function s(t){return CRUD.stats.writesExecuted++,console.error(&quot;Insert query error: &quot;,t),t}this.databaseName=t,this.dbOptions=e,this.lastQuery=!1,this.initializing=!0,CRUD.ConnectionAdapter.apply(this,arguments);var a,o=this;this.Init=function(){return this.db=a=new CRUD.Database(o.databaseName),a.connect().then(function(){return CRUD.log(&quot;SQLITE connection created to &quot;,o.databaseName),u().then(function(){o.initializing=!1})})};var u=function(){CRUD.log(&quot;verifying that tables exist&quot;);var t=[],e={};return a.execute(&quot;select type,name,tbl_name from sqlite_master&quot;).then(function(n){for(var i=0;i&lt;n.rs.rows.length;i++){var r=n.rs.rows.item(i);r.name.indexOf(&quot;sqlite_autoindex&quot;)&gt;-1||&quot;__WebKitDatabaseInfoTable__&quot;==r.name||(&quot;table&quot;==r.type?t.push(r.tbl_name):&quot;index&quot;==r.type&amp;&amp;(r.tbl_name in e||(e[r.tbl_name]=[]),e[r.tbl_name].push(r.name)))}}).then(function(){return Promise.all(Object.keys(CRUD.EntityManager.entities).map(function(e){var n=CRUD.EntityManager.entities[e];if(-1==t.indexOf(n.table)){if(!n.createStatement)throw&quot;No create statement found for &quot;+n.className+&quot;. Don't know how to create table.&quot;;return a.execute(n.createStatement).then(function(){return t.push(n.table),localStorage.setItem(&quot;database.version.&quot;+n.table,&quot;migrations&quot;in n?Math.max.apply(Math,Object.keys(n.migrations)):1),CRUD.log(n.className+&quot; table created.&quot;),n},function(t){throw CRUD.log(&quot;Error creating &quot;+n.className,t),&quot;Error creating table: &quot;+n.table+&quot; for &quot;+n.className}).then(l).then(function(){CRUD.log(&quot;Table created and fixtures inserted for &quot;,n.className)})}}))}).then(function(){return Promise.all(Object.keys(CRUD.EntityManager.entities).map(function(t){var e=CRUD.EntityManager.entities[t];if(e.migrations){var n=localStorage.getItem(&quot;database.version.&quot;+e.table)?parseInt(localStorage.getItem(&quot;database.version.&quot;+e.table),10):1;isNaN(n)&amp;&amp;(n=1);var i=Math.max.apply(Math,Object.keys(e.migrations));if(n==i)return;return Promise.all(Object.keys(e.migrations).map(function(i){return parseInt(i)&gt;n?Promise.all(e.migrations[i].map(function(e){return CRUD.log(&quot;Executing migration: &quot;,e),a.execute(e).then(function(t){return CRUD.log(&quot;Migration success!&quot;,t),!0},function(){throw&quot;Migration &quot;+i+&quot; failed for entity &quot;+t})})).then(function(){return CRUD.log(&quot;All migrations executed for version &quot;,i),localStorage.setItem(&quot;database.version.&quot;+e.table,i),!0}):!0}))}}))}).then(function(){return Promise.all(Object.keys(CRUD.EntityManager.entities).map(function(t){var n=CRUD.EntityManager.entities[t];return&quot;indexes&quot;in n?Promise.all(n.indexes.map(function(t){var i=t.replace(/\W/g,&quot;&quot;)+&quot;_idx&quot;;return n.table in e&amp;&amp;-1!=e[n.table].indexOf(i)?void 0:a.execute(&quot;create index if not exists &quot;+i+&quot; on &quot;+n.table+&quot; (&quot;+t+&quot;)&quot;).then(function(){CRUD.log(&quot;index created: &quot;,n.table,t,i),n.table in e||(e[n.table]=[]),e[n.table].push(i)})})):void 0}))}).then(function(){CRUD.log(&quot;All migrations are done!&quot;),o.initializing=!1})},l=function(t){return new Promise(function(e,n){return t.fixtures?Promise.all(t.fixtures.map(function(e){CRUD.fromCache(t.className,e).Persist(!0)})).then(e,n):e()})},c=function(t){return o.initializing?void setTimeout(c,50,t):t()};return this.Find=function(t,e,n){var i=new CRUD.Database.SQLBuilder(t,e,n),r=i.buildQuery();return CRUD.log(&quot;Executing query via sqliteadapter: &quot;,n,r),new Promise(function(t,e){return c(function(){a.execute(r.query,r.parameters).then(function(e){for(var n=[],i=0;i&lt;e.rs.rows.length;i++)n.push(e.rs.rows.item(i));t(n)},function(t,n){CRUD.log(&quot;SQL Error in FIND : &quot;,n,t,r),e()})})})},this.Persist=function(t,e){function o(e){f.push(e),h.push(&quot;?&quot;),g.push(t.__dirtyValues__[e])}function u(e){e in t.__dirtyValues__||e in t.__values__||(f.push(e),h.push(&quot;?&quot;),g.push(CRUD.EntityManager.entities[t.getType()].defaultValues[e]))}function l(t){f.indexOf(t)&gt;-1&amp;&amp;(g[f.indexOf(t)]=JSON.stringify(g[f.indexOf(t)]))}CRUD.stats.writesQueued++;var c=[],h=[],g=[],f=[];return Object.keys(t.__dirtyValues__).map(o),Object.keys(CRUD.EntityManager.entities[t.getType()].defaultValues).map(u),CRUD.EntityManager.entities[t.getType()].autoSerialize.map(l),t.getID()===!1||void 0===t.getID()||e?(c.push(&quot;INSERT INTO &quot;,CRUD.EntityManager.entities[t.getType()].table,&quot;(&quot;,f.join(&quot;,&quot;),&quot;) VALUES (&quot;,h.join(&quot;,&quot;),&quot;);&quot;),CRUD.log(c.join(&quot; &quot;),g),a.execute(c.join(&quot; &quot;),g).then(r,s)):(c.push(&quot;UPDATE&quot;,CRUD.EntityManager.entities[t.getType()].table,&quot;SET&quot;,f.map(function(t){return t+&quot; = ?&quot;}).join(&quot;,&quot;)),g.push(t.getID()),c.push(&quot;WHERE&quot;,CRUD.EntityManager.getPrimary(t.getType()),&quot;= ?&quot;),a.execute(c.join(&quot; &quot;),g).then(n,i))},this.Delete=function(t){return t.getID()!==!1?(query=[&quot;delete from&quot;,CRUD.EntityManager.entities[t.getType()].table,&quot;where&quot;,CRUD.EntityManager.getPrimary(t.getType()),&quot;= ?&quot;].join(&quot; &quot;),a.execute(query,[t.getID()]).then(function(t){return t.Action=&quot;deleted&quot;,t},function(t){throw CRUD.log(&quot;error deleting element from db: &quot;,t),t})):!1},this},CRUD.Database=function(t,e){function n(){a.length&gt;0&amp;&amp;r.transaction(function(t){var e=a.splice(0,25);0!==e.length&amp;&amp;e.map(function(e){function n(t,n){e.resolve(new CRUD.Database.ResultSet(n))}function i(t,n){CRUD.log(&quot;SQL FAIL!!&quot;,n,t),e.fail(n,t)}t.executeSql(e.sql,e.valueBindings,n,i),CRUD.DEBUG&amp;&amp;CRUD.log(e.sql,e.valueBindings)})})}e=e||{version:&quot;1.0&quot;,estimatedSize:655360};var i=0,r=!1,s=t||!1;this.lastInsertId=function(){return i},this.close=function(){return r.close()},this.getDB=function(){return r};var a=[];this.execute=function(t,e){return r?new Promise(function(i,r){a[0===t.indexOf(&quot;SELECT&quot;)?&quot;unshift&quot;:&quot;push&quot;]({sql:t,valueBindings:e,resolve:i,fail:r}),setTimeout(n,10)}):void 0},this.connect=function(){return new Promise(function(t,n){try{r=openDatabase(s,e.version,&quot;&quot;,e.estimatedSize),r?(CRUD.log(&quot;DB connection to &quot;,s,&quot; opened!&quot;),t(this)):n(&quot;could not open database &quot;+s)}catch(i){CRUD.log(&quot;DB ERROR &quot;+i.toString()),n(&quot;ERROR!&quot;+i.toString(),i)}})}},CRUD.Database.ResultSet=function(t){return this.rs=t,this.index=0,this},CRUD.Database.ResultSet.prototype.next=function(){var t=null;return this.index&lt;this.rs.rows.length&amp;&amp;(t=new CRUD.Database.ResultSet.Row(this.rs.rows.item(this.index++))),t},CRUD.Database.ResultSet.Row=function(t){return this.row=t,this},CRUD.Database.ResultSet.Row.prototype.get=function(t,e){var n=this.row[t];return n?n:e},CRUD.Database.SQLBuilder=function(t,e,n){this.entity=t instanceof CRUD.Entity?t.getType():t,this.entityConfig=CRUD.EntityManager.entities[this.entity],this.filters=e||{},this.options=n||{},this.justthese=[],this.wheres=[],this.joins=[],this.fields=[],this.orders=[],this.groups=[],this.parameters=[],Object.keys(this.filters).map(function(t){this.buildFilters(t,this.filters[t],this.entity)},this),this.options.orderBy?this.orders.push(this.prefixFieldNames(this.options.orderBy.replace(&quot;ORDER BY&quot;,&quot;&quot;))):this.entityConfig.orderProperty&amp;&amp;this.entityConfig.orderDirection&amp;&amp;0===this.orders.length&amp;&amp;this.orders.push(this.getFieldName(this.entityConfig.orderProperty)+&quot; &quot;+this.entityConfig.orderDirection),this.options.groupBy&amp;&amp;this.groups.push(this.options.groupBy.replace(&quot;GROUP BY&quot;,&quot;&quot;)),this.limit=this.options.limit?&quot;LIMIT &quot;+n.limit:&quot;LIMIT 0,1000&quot;,(this.options.justthese||CRUD.EntityManager.entities[this.entity].fields).map(function(t){this.fields.push(this.getFieldName(t))},this)},CRUD.Database.SQLBuilder.prototype={getFieldName:function(t,e){return(e||this.entityConfig.table)+&quot;.&quot;+t},prefixFieldNames:function(t){var e=t.split(&quot;,&quot;);return e.map(function(t){var e=t.trim().split(&quot; &quot;),n=e[1].toUpperCase().match(/(ASC|DESC)/)[0];return t=e[0],this.entityConfig.fields.indexOf(t)&gt;-1&amp;&amp;(t=this.getFieldName(t)),t+&quot; &quot;+n},this).join(&quot;, &quot;)},buildFilters:function(t,e,n){var i=CRUD.EntityManager.hasRelation(n,t);if(i)for(var r in e)this.buildFilters(r,e[r],t),this.buildJoins(n,t);else isNaN(parseInt(t,10))?(&quot;ID&quot;==t&amp;&amp;(t=CRUD.EntityManager.getPrimary(n)),this.wheres.push(this.getFieldName(t,CRUD.EntityManager.entities[n].table)+&quot; = ?&quot;),this.parameters.push(e)):this.wheres.push(e)},buildJoins:function(t,e){if(e){var n=CRUD.EntityManager.entities[t];switch(e=CRUD.EntityManager.entities[e],e.relations[n.className]){case CRUD.RELATION_SINGLE:case CRUD.RELATION_FOREIGN:n.fields.indexOf(e.primary)&gt;-1?this.addJoin(e,n,e.primary):e.fields.indexOf(n.primary)&gt;-1&amp;&amp;this.addJoin(e,n,n.primary);break;case CRUD.RELATION_MANY:connectorClass=e.connectors[n.getType()],conn=CRUD.EntityManager.entities[connectorClass],this.addJoin(conn,n,n.primary).addJoin(e,conn,e.primary);break;case CRUD.RELATION_CUSTOM:var i=e.relations[n.getType()];this.joins=this.joins.unshift([&quot;LEFT JOIN&quot;,n.table,&quot;ON&quot;,this.getFieldName(i.sourceProperty,e.table),&quot;=&quot;,this.getFieldName(i.targetProperty,n.table)].join(&quot; &quot;));break;default:throw new Exception(&quot;Warning! class &quot;+e.getType()+&quot; probably has no relation defined for class &quot;+n.getType()+&quot;  or you did something terribly wrong...&quot;+JSON.encode(e.relations[_class]))}}},addJoin:function(t,e,n,i){var r=[&quot;LEFT JOIN&quot;,t.table,&quot;ON&quot;,this.getFieldName(n,e.table),&quot;=&quot;,this.getFieldName(i||n,t.table)].join(&quot; &quot;);return-1==this.joins.indexOf(r)&amp;&amp;this.joins.push(r),this},buildQuery:function(){var t=this.wheres.length&gt;0?&quot; WHERE &quot;+this.wheres.join(&quot; \n AND \n	&quot;):&quot;&quot;,e=this.orders.length&gt;0?&quot; ORDER BY &quot;+this.orders.join(&quot;, &quot;):&quot;&quot;,n=this.groups.length&gt;0?&quot; GROUP BY &quot;+this.groups.join(&quot;, &quot;):&quot;&quot;,i=&quot;SELECT &quot;+this.fields.join(&quot;, \n	&quot;)+&quot;\n FROM \n	&quot;+CRUD.EntityManager.entities[this.entity].table+&quot;\n &quot;+this.joins.join(&quot;\n &quot;)+t+&quot; &quot;+n+&quot; &quot;+e+&quot; &quot;+this.limit;return{query:i,parameters:this.parameters}},getCount:function(){var t=this.wheres.length&gt;0?&quot; WHERE &quot;+this.wheres.join(&quot; \n AND \n	&quot;):&quot;&quot;,e=this.groups.length&gt;0?&quot; GROUP BY &quot;+this.groups.join(&quot;, &quot;):&quot;&quot;,n=&quot;SELECT count(*) FROM \n	&quot;+CRUD.EntityManager.entities[this.entity].table+&quot;\n &quot;+this.joins.join(&quot;\n &quot;)+t+&quot; &quot;+e;return n}};</code></pre>
          <div class="footer site-footer">
            <div class="span site-footer-owner"><a href="https://github.com/mr-doc/mr-doc-theme-cayman">Cayman</a> is maintained by <a href="https://github.com/iwatakeshi">iwatakeshi</a>.</div>
            <div class="span site-footer-credits">This page was generated by <a href="https://github.com/mr-doc/mr-doc">Mr. Doc</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</div>
          </div>
        </div>
      </div>
    </section>
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/affix.js"></script>
    <script src="../js/dropdown.js"></script>
    <script src="../js/scrollspy.js"></script>
    <script src="../js/prism.js"></script>
    <script src="../js/prism-bash.js"></script>
    <script>
      $(document).ready(function(){
        $('body').scrollspy({
          target: ".bs-docs-sidebar",
          offset: 40
        });
        $('#sidebar').affix({
          offset:{
            bottom:60,
            top: 60
          }
        }) 
      });
    </script>
  </body>
</html>